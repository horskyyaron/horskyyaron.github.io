<!DOCTYPE html>






























<html
  class="not-ready text-sm lg:text-base"
  style="--bg: #faf6f1"
  lang="en-us"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>Recursive Macros in Vim - scratchingItch</title>

  
  <meta name="theme-color" />
  
  <meta name="description" content="Using recursive macro, an example Tip: read this post in light-mode for better visuals.
to see the final product in action click here
My Goal I&rsquo;m summerzing a chapter of abook i&rsquo;m reading, I&rsquo;m writting these summeries in markdown.
I went ahead and looked at the chapters sub-chapters titles so I could write them down at the top of the summary page, and make hyper links to these section for fast navigation, meaning, when clicking a link it will jump to that section on the same page." />
  <meta
    name="author"
    content=""
  />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://horskyyaron.github.io/main.min.css" />

  

  
     
  <link rel="preload" as="image" href="https://horskyyaron.github.io/theme.png" />

  
  
  
  

  
  <link rel="preload" as="image" href="https://horskyyaron.github.io/github.svg" />
  
  <link rel="preload" as="image" href="https://horskyyaron.github.io/rss.svg" />
  

  
  <link rel="icon" href="https://horskyyaron.github.io/favicon.ico" />
  <link rel="apple-touch-icon" href="https://horskyyaron.github.io/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.110.0">

  
  

  
  
  
  
  
  
  
  
  
  <meta property="og:title" content="Recursive Macros in Vim" />
<meta property="og:description" content="Using recursive macro, an example Tip: read this post in light-mode for better visuals.
to see the final product in action click here
My Goal I&rsquo;m summerzing a chapter of abook i&rsquo;m reading, I&rsquo;m writting these summeries in markdown.
I went ahead and looked at the chapters sub-chapters titles so I could write them down at the top of the summary page, and make hyper links to these section for fast navigation, meaning, when clicking a link it will jump to that section on the same page." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://horskyyaron.github.io/posts/recursicve-macros-in-vim/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-22T18:02:26+02:00" />
<meta property="article:modified_time" content="2023-02-22T18:02:26+02:00" />

  
  <meta itemprop="name" content="Recursive Macros in Vim">
<meta itemprop="description" content="Using recursive macro, an example Tip: read this post in light-mode for better visuals.
to see the final product in action click here
My Goal I&rsquo;m summerzing a chapter of abook i&rsquo;m reading, I&rsquo;m writting these summeries in markdown.
I went ahead and looked at the chapters sub-chapters titles so I could write them down at the top of the summary page, and make hyper links to these section for fast navigation, meaning, when clicking a link it will jump to that section on the same page."><meta itemprop="datePublished" content="2023-02-22T18:02:26+02:00" />
<meta itemprop="dateModified" content="2023-02-22T18:02:26+02:00" />
<meta itemprop="wordCount" content="1328">
<meta itemprop="keywords" content="vim," />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Recursive Macros in Vim"/>
<meta name="twitter:description" content="Using recursive macro, an example Tip: read this post in light-mode for better visuals.
to see the final product in action click here
My Goal I&rsquo;m summerzing a chapter of abook i&rsquo;m reading, I&rsquo;m writting these summeries in markdown.
I went ahead and looked at the chapters sub-chapters titles so I could write them down at the top of the summary page, and make hyper links to these section for fast navigation, meaning, when clicking a link it will jump to that section on the same page."/>

  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold"
      href="https://horskyyaron.github.io/"
      >scratchingItch</a
    >
    <a
      class="btn-dark ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]"
    ></a>
  </div>

  <a
    class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
  ></a>

  
  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = `"#faf6f1"`.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    
    <nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6">
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/about/"
        >About</a
      >
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/contact/"
        >Contact</a
      >
      
    </nav>
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href="https://github.com/YOUR_GITHUB_ID"
        target="_blank"
        rel="me"
      ></a>
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./rss.svg)"
        href="https://horskyyaron.github.io/index.xml"
        target="_blank"
        
      ></a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-20 pb-32 dark:prose-invert"
    >
      

<article>
  <header class="mb-20">
    <h1 class="!my-0 pb-2.5">Recursive Macros in Vim</h1>

    
    <div class="text-sm opacity-60">
      
      <time>Feb 22, 2023</time>
      
      
    </div>
    
  </header>

  <section><h1 id="using-recursive-macro-an-example">Using recursive macro, an example</h1>
<p>Tip: read this post in <strong>light-mode</strong> for better visuals.<br>
to see the final product in action click <a href="#final-product">here</a></p>
<h2 id="my-goal">My Goal</h2>
<p>I&rsquo;m summerzing a chapter of abook i&rsquo;m reading, I&rsquo;m writting these summeries in markdown.</p>
<p>I went ahead and looked at the chapters sub-chapters titles so I could write them down at the top of the summary page, and make hyper links
to these section for fast navigation, meaning, when clicking a link it will jump to that section on the same page.</p>
<h3 id="linking-to-a-header-in-a-markdown-file">Linking to a header in a markdown file</h3>
<p>let say i have a heading:</p>
<pre tabindex="0"><code># Section 1
</code></pre><p>to make an &lsquo;in-page&rsquo; link to this header:</p>
<pre tabindex="0"><code>[link text](#&lt;Header text&gt;)
</code></pre><p>when the header has spaces in it, we need to use hiphens <code>-</code> between the words.<br>
So, to make a link to section 1 header we will write:</p>
<pre tabindex="0"><code>[click here to go to section 1](#Section-1)
</code></pre><h3 id="my-case">My Case</h3>
<p>So I copied the different chapter headings:</p>
<pre tabindex="0"><code># Chapter 3 summary

In this chapter we covered:
* working in topic branches
* applying patches from email
* checking out remote branches
* determining what is intoroduced
* integrating contributed work
* Tagging your releases
* generating a build number
* preparing a release
* the shortlog
* summary
</code></pre><p>To make each of these a link to a header with same name, our <em><strong>goal file</strong></em> would be:</p>
<pre tabindex="0"><code># Chapter 3 summary

In this chapter we covered:
* [working in topic branches](#working-in-topic-branches)
* [applying patches from email](#applying-patches-from-email)
* [checking out remote branches](#checking-out-remote-branches)
* [determining what is intoroduced](#determining-what-is-intoroduced)
* [integrating contributed work](#integrating-contributed-work)
* [Tagging your releases](#Tagging-your-releases)
* [generating a build number](#generating-a-build-number)
* [preparing a release](#preparing-a-release)
* [the shortlog](#the-shortlog)
* [summary](#summary)
</code></pre><h2 id="the-solution---vim-macros">The solution - Vim Macros</h2>
<h3 id="lets-divide-and-conquer---working-on-one-header">Lets divide and conquer - working on one header.</h3>
<p>As we can see, this is a repetitive task.<br>
In each line we make 3 steps:</p>
<ol>
<li>copy the sub-chapter header</li>
<li>put it in a <code>[&lt;heading&gt;]</code> brackets, followed by <code>(#&lt;heading&gt;)</code> brackets.</li>
<li>replace all spaces <code> </code> in the <code>(#&lt;heading&gt;)</code> brackets with hipens <code>-</code></li>
</ol>
<p>We&rsquo;ll work on one row, and move on from there.<br>
we want to transform:</p>
<pre tabindex="0"><code>* working in topic branches
</code></pre><p>to</p>
<pre tabindex="0"><code>* [working in topic branches](#working-in-topic-branches)
</code></pre><hr>
<p>To copy the sub-chapter title, we&rsquo;ll go to <code>w</code> at the beggening and <code>y$</code> to yank until the end of the line.<br>
(<strong>This is step 0</strong>).<br>
Then, we go back to <code>w</code> and we&rsquo;ll:</p>
<pre tabindex="0"><code>i[&lt;C-o&gt;&lt;Shift-a&gt;](#&lt;C-o&gt;p)&lt;esc&gt;
</code></pre><p>(<strong>this is step 2</strong>)<br>
It only looks scary, let&rsquo;s break it down:</p>
<ul>
<li><strong>i[</strong> - puts us in insert mode, and typing <code>[</code></li>
<li><strong>&lt;C-o&gt;</strong> - when in insert mode, <strong>&lt;C-o&gt;</strong> will put us in Normal mode for one action, then goes back to insert mode immediatly.</li>
<li><strong>&lt;Shift-a&gt;](#</strong> - will append to the end of the line, where we enter <strong>](#</strong> to finish the first brackets and start with the <strong>(</strong> link brackets, which starts with <strong>#</strong> character because we link to a heading.</li>
<li><strong>&lt;C-o&gt;p)&lt;esc&gt;</strong> - will take us to normal mode for one command, where we use <strong>p</strong> for pasting the heading we yanked at the beggening. then we enter the closing <strong>)</strong> and by <strong>&lt;esc&gt;</strong> we finish and go back to normal mode.</li>
</ul>
<p>Now we need to replace the spaces inside the <strong>()</strong> brackets with hipens <strong>-</strong>.
we&rsquo;ll:</p>
<pre tabindex="0"><code>vi):s/\%V /-/g\&lt;Cr&gt;
</code></pre><p>(<strong>this is step 3</strong>)</p>
<ul>
<li><strong>vi)</strong> - willl visual select the text inside the <strong>()</strong> brackets.</li>
<li><strong>:s/%V /-/g&lt;cr&gt;</strong> - <strong>:</strong> will put us in command mode. <strong>s/</strong> is the start of substitution command. <strong>%V</strong> restricts the pattern to only the visual selection. <strong>:s/%V /-/</strong> will reaplace the first space in the visual selection with hipen <strong>-</strong> and by adding the flag <strong>g</strong> in the end, it will do so to all spaces until the end of the line . finally <strong>&lt;cr&gt;</strong> will confirm our substitution.</li>
</ul>
<h3 id="recording-our-hard-work">Recording our hard work</h3>
<p>In the end, we need to do the same work on each line.<br>
if this was python we code we could think about it this way:</p>
<pre tabindex="0"><code>def task(line):
    ...making line as we want using some vim dark magic...

for h in headers_lines:
    task(h)
</code></pre><p>by recording a <em><strong>vim macro</strong></em>, we can use the <em><strong>same sequence of keystrokes</strong></em> on each row. (in the python analogy, applying the function on each line)</p>
<hr>
<h4 id="macros-basics">Macros basics</h4>
<ol>
<li><em><strong>recording:</strong></em></li>
</ol>
<p>So, how do we record a macro? easy:</p>
<pre tabindex="0"><code>q&lt;register&gt;&lt;key storkes we want to save&gt;q
</code></pre><p>this will save all of the keystrokes into the given register.</p>
<ol start="2">
<li><em><strong>using macro</strong></em>:</li>
</ol>
<pre tabindex="0"><code>@&lt;register&gt;
</code></pre><p>e.g</p>
<pre tabindex="0"><code>qqihello&lt;esc&gt;q
</code></pre><p>in normal mode, if we <code>@q</code>,the macro will put us into insert mode, then, it will type &lsquo;hello&rsquo; and go back to normal mode by escaping.</p>
<p><em><strong>note</strong></em>: the macro will keep recording <em><strong>after</strong></em> clicking on <code>&lt;esc&gt;</code>, it will finish its recording only when clicking on <code>q</code> again, in normal mode.</p>
<hr>
<p>To make our hading macro we&rsquo;ll need to do the following:</p>
<pre tabindex="0"><code>qq&lt;step 1&gt;&lt;step 2&gt;&lt;step 3&gt;&lt;esc&gt;q
</code></pre><p>where each <code>&lt;step X&gt;</code> is the keystorkes we mentioned above.</p>
<h3 id="using-our-recorded-macro---2-ways">Using our recorded macro - 2 ways</h3>
<p>As in most things &ldquo;vim&rdquo;, we can have many options for achiving a desired outcome.
here we&rsquo;ll present 2 ways:</p>
<ul>
<li>the norm(al) way.</li>
<li>the cool/black-magic/recursive macro way.</li>
</ul>
<h4 id="the-normal-way">The norm(al) way</h4>
<p>we will use the <code>:normal</code> command (<code>:norm</code> is the shorter version)<br>
this command allows us to execute normal mode commands typed on the command line.<br>
when we visual select and use <code>:norm</code> commad, it will apply the given normal mode commands on each line that was selected.</p>
<p>So to use our macro, which we recorded to register <code>q</code> (arbitrary, we could use any other register we wanted), on each line (each header), we&rsquo;ll visual select all of the lines and enter:</p>
<pre tabindex="0"><code>:norm @q
</code></pre><p>simple as that. this will preform steps 1-3 on each line.</p>
<h3 id="the-coolblack-magicrecursive-macro-way">the cool/black-magic/recursive macro way.</h3>
<p>an even cooler option would be using vim macro <em><strong>recursivly</strong></em>.<br>
lets look at a recursive function and deduced how we would use recursive macro.</p>
<pre tabindex="0"><code>def foo(i):
    if i == 0
        return 0
    return i + func(i-1)
</code></pre><p>this is a simple recursive function to calculate the sum of all number from 0 to a given number.<br>
we can see that we call <code>func</code> from inside of <code>func</code> to make a recursive call.</p>
<p>So, to make a recursive macro we&rsquo;ll need to do something similar to:</p>
<pre tabindex="0"><code>qq&lt;some keystrokes...&gt;@qq
                    ^^^^ using macro in register q
</code></pre><p>what happens here?</p>
<p>we are recording a macro into register <code>q</code>, we type some keystrokes we want to save. then we use that macro by <code>@q</code> and then finish its recording by typing <code>q</code> again.
we are calling the macro from inside the macro, thus making it recursive call.</p>
<p><em><strong>Important note</strong></em>: we want to use a &lsquo;clean&rsquo; register. meaning, with no recorded keystorkes on it.
why? becuase when we call when we are recording, if it&rsquo;s not empty, it will execute the previous recoded keystores.
to make a macro &lsquo;clean&rsquo;, we&rsquo;ll simply:</p>
<pre tabindex="0"><code>q&lt;register&gt;q
</code></pre><p>I will not go over error handling and stopping conditions, just want to give a basic simple example of when i use vim macro recursivly.
essentialy, it will continue until an error was raised or until end of file has reached.</p>
<h3 id="constructing-recursive-macro-correctly">Constructing recursive macro correctly</h3>
<p>when using macro recursivly, we need to think of the <em><strong>ending point</strong></em> of the keystrokes sequence so when the recursive call will be made, the right conditions will be presented before applying the keystrokes.</p>
<p>lets examine our text:</p>
<pre tabindex="0"><code>* working in topic branches
* applying patches from email
</code></pre><p>if our <em><strong>starting point</strong></em> on each call will be th <em><strong>beginning of the line,</strong></em> we could just move to the right twice and copy the header and continue from there.
so we need to <em><strong>end</strong></em>  the recursive macro keystrokes(before calling <code>@q</code> in the macro recording) by going down one line, and go to it&rsquo;s beggening.</p>
<p>essentially we need to:</p>
<pre tabindex="0"><code>qqq - will clean &#39;q&#39; register from previous recordings.

qq&lt;step1&gt;&lt;step2&gt;&lt;step3&gt;j0@qq
</code></pre><p>by adding <code>j0</code> we are going down one line and moving to it&rsquo;s beggining to make the starting point for the recursive call valid.</p>
<p>all we need to do now to accomplish our goal, is to go to the first line, and:</p>
<pre tabindex="0"><code>@q
</code></pre><p>cool isn&rsquo;t it?</p>
<h5 id="final-product">final product</h5>
<p><img src="/vim.gif" alt="my image"></p>
</section>

  
  
  <footer class="mt-12 flex flex-wrap">
     
    <a
      class="mr-1.5 mb-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://horskyyaron.github.io/tags/vim"
      >vim</a
    >
    
  </footer>
  

  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    
    <a
      class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 no-underline hover:bg-black/[2%]"
      href="https://horskyyaron.github.io/posts/first/"
      ><span>My First Post!</span><span class="ml-1.5">→</span></a
    >
    
  </nav>
  

  
  

  
  
  <div class="mt-24" id="graphcomment"></div>
  <script type="text/javascript">
    var __semio__params = {
      graphcommentId: 'YOUR_GRAPH_COMMENT_ID',
      behaviour: {
        
      },
      
    };

    function __semio__onload() {
      __semio__gc_graphlogin(__semio__params);
    }

    (function () {
      var gc = document.createElement('script');
      gc.type = 'text/javascript';
      gc.async = true;
      gc.onload = __semio__onload;
      gc.defer = true;
      gc.src =
        'https://integration.graphcomment.com/gc_graphlogin.js?' + Date.now();
      (
        document.getElementsByTagName('head')[0] ||
        document.getElementsByTagName('body')[0]
      ).appendChild(gc);
    })();
  </script>
  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2023
    <a class="link" href="https://horskyyaron.github.io">scratchingItch</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >Powered by Hugo️️</a
  >️
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >▷ Paper 6</a
  >
</footer>

  </body>
</html>
